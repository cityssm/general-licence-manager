"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.querySelector("main").dataset.urlPrefix,t=""===document.querySelector("#licenceEdit--licenceId").value,n=document.querySelector("#licenceEdit--licenceCategoryKey"),c=document.querySelector("#licenceEdit--isRenewal"),i=document.querySelector("#licenceEdit--startDateString"),l=document.querySelector("#licenceEdit--endDateString"),r=()=>{const e=i.valueAsDate;if(!e||""===n.value)return void(l.value="");const t=n.selectedOptions[0],c=Number.parseInt(t.dataset.licenceLengthYears),r=Number.parseInt(t.dataset.licenceLengthMonths),a=Number.parseInt(t.dataset.licenceLengthDays);c>0&&(e.setFullYear(e.getFullYear()+c),e.setDate(e.getDate()-1)),r>0&&(e.setMonth(e.getMonth()+r),e.setDate(e.getDate()-1)),a>0&&e.setDate(e.getDate()+a-1),l.valueAsDate=e};let a;t&&n.addEventListener("change",r),i.addEventListener("change",r);const o=()=>{const e=document.querySelector("#licenceEdit--licenceFee"),t=document.querySelector("#licenceEdit--replacementFee");if(!a||0===a.licenceCategoryFees.length)return e.value="",void(t.value="");e.value=c.checked?a.licenceCategoryFees[0].renewalFee.toFixed(2):a.licenceCategoryFees[0].licenceFee.toFixed(2),t.value=a.licenceCategoryFees[0].replacementFee.toFixed(2)},s=()=>{(()=>{const e=document.querySelector("#container--licenceFields");if(!a||0===a.licenceCategoryFields.length)return e.innerHTML="",void e.classList.add("is-hidden");e.classList.remove("is-hidden"),e.innerHTML='<h2 class="title is-3">Fields</h2>';const t=[];for(const n of a.licenceCategoryFields){const c=document.createElement("div");c.className="field",c.innerHTML='<label class="label"></label><div class="control"><input class="input" type="text" /></div>';const i="licenceFieldEdit--"+n.licenceFieldKey,l=c.querySelector("label");l.setAttribute("for",i),l.textContent=n.licenceField;const r=c.querySelector("input");if(r.id=i,r.name="field--"+n.licenceFieldKey,r.minLength=n.minimumLength,r.maxLength=n.maximumLength,""!==n.pattern&&(r.pattern=n.pattern),n.isRequired&&(r.required=!0),""!==n.licenceFieldDescription){const e=document.createElement("p");e.className="help",e.textContent=n.licenceFieldDescription,c.append(e)}e.append(c),t.push(n.licenceFieldKey)}const n=document.createElement("input");n.type="hidden",n.name="licenceFieldKeys",n.value=t.join(","),e.append(n)})(),(()=>{const e=document.querySelector("#container--licenceApprovals");if(!a||0===a.licenceCategoryApprovals.length)return e.innerHTML="",void e.classList.add("is-hidden");e.classList.remove("is-hidden"),e.innerHTML='<h2 class="title is-3">Approvals</h2>';const t=[];for(const n of a.licenceCategoryApprovals){const i=document.createElement("div");i.className="facheck mt-2",i.innerHTML='<input type="checkbox" /><label></label>';const l="licenceApprovalEdit--"+n.licenceApprovalKey,r=i.querySelector("label");r.setAttribute("for",l),r.textContent=n.licenceApproval;const a=i.querySelector("input");if(a.id=l,a.name="approval--"+n.licenceApprovalKey,a.dataset.isRequiredForNew=n.isRequiredForNew?"true":"false",a.dataset.isRequiredForRenewal=n.isRequiredForRenewal?"true":"false",(c.checked&&n.isRequiredForRenewal||!c.checked&&n.isRequiredForNew)&&(a.required=!0),e.append(i),""!==n.licenceApprovalDescription){const t=document.createElement("p");t.className="help",t.textContent=n.licenceApprovalDescription,e.append(t)}t.push(n.licenceApprovalKey)}const n=document.createElement("input");n.type="hidden",n.name="licenceApprovalKeys",n.value=t.join(","),e.append(n)})(),o()},d=()=>{if(""===n.value)return a=void 0,void s();cityssm.postJSON(e+"/licences/doGetLicenceCategory",{licenceCategoryKey:n.value},e=>{a=e.licenceCategory,s()})};t?n.addEventListener("change",d):a=exports.licenceCategory,c.addEventListener("change",()=>{const e=document.querySelector("#container--licenceApprovals").querySelectorAll("input");for(const t of e)t.required=!!(c.checked&&"true"===t.dataset.isRequiredForRenewal||!c.checked&&"true"===t.dataset.isRequiredForNew);o()})})();