"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const t=document.querySelector("main").dataset.urlPrefix,e=exports.licenceAlias,a=document.querySelector("#table--transactionBatches");exports.licences;let n=[];const c=a=>{a.preventDefault();const n=a.currentTarget,c=n.value,s=n.closest("td").dataset.batchDateString,l=n.closest("tr").dataset.licenceId;cityssm.postJSON(t+"/batches/doCreateOrUpdateBatchTransaction",{licenceId:l,batchDateString:s,transactionAmount:c},t=>{if(t.success&&(r=t.batchTransactions,o()),t.message){const a=n.closest("tr").dataset.licenceNumber;bulmaJS.alert({title:e+" #"+a+", Batch "+s,message:t.message,contextualColorName:t.success?"warning":"danger"})}})},s=()=>{const t=a.querySelectorAll("[data-batch-date-string]");for(const e of t)e.remove();const e=a.querySelectorAll("tbody tr");for(const t of n){const n=document.createElement("th");n.dataset.batchDateString=t,n.innerHTML=t,a.querySelector("thead th:last-child").insertAdjacentElement("beforebegin",n);const s=document.createElement("th");n.dataset.batchDateString=t,a.querySelector("tfoot th:last-child").insertAdjacentElement("beforebegin",s);for(const a of e){const e=document.createElement("td");e.dataset.batchDateString=t,e.innerHTML='<div class="control has-icons-left"><input class="input is-small has-text-right" data-field="transactionAmount" type="number" min="0" /><span class="icon is-small is-left"><i class="fas fa-dollar-sign" aria-hidden="true"></i></span></div>';const n=e.querySelector("input");n.min="0",n.max=a.dataset.outstandingBalance,n.step="0.01",n.addEventListener("change",c),a.querySelector("td:last-child").insertAdjacentElement("beforebegin",e)}}};let r=exports.batchTransactions;(()=>{const t=new Set;for(const e of r)t.add(e.batchDateString);(n=[...t.values()]).sort()})();const o=()=>{for(const t of r){a.querySelector("tr[data-licence-id='"+t.licenceId+"']").querySelector("td[data-batch-date-string='"+t.batchDateString+"']").querySelector("input").value=t.transactionAmount.toFixed(2)}};s(),o(),document.querySelector("#is-add-batch-button").addEventListener("click",t=>{let e,a;t.preventDefault();const c=t=>{t.preventDefault();const c=e.value;n.includes(c)?bulmaJS.alert({title:"Batch Date Already Included",message:"To add a new batch, choose a new date."}):(n.push(c),n.sort(),a(),s(),o())};cityssm.openHtmlModal("batchBuilder-addBatch",{onshown:(t,n)=>{e=t.querySelector("#addBatch--batchDateString"),a=n,t.querySelector("#form--addBatch").addEventListener("submit",c)}})})})();