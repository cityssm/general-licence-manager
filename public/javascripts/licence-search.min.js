"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.querySelector("main").dataset.urlPrefix,t=document.querySelector("#form--filters"),s=document.querySelector("#filter--limit"),n=document.querySelector("#filter--offset"),a=document.querySelector("#container--searchResults"),i=()=>{const c=Number.parseInt(s.value,10),r=Number.parseInt(n.value,10);a.innerHTML='<p class="has-text-centered has-text-grey-lighter"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading licences...</em></p>',cityssm.postJSON(e+"/licences/doSearch",t,t=>{const s=t.licences;if(0===s.length)return void(a.innerHTML='<div class="message is-info"><div class="message-body"><strong>Your search returned no results.</strong><br />Please try expanding your search criteria.</div></div>');a.innerHTML='<table class="table is-fullwidth is-striped is-hoverable has-sticky-header"><thead><tr><th>Licence Number</th><th>Category</th><th>Licensee</th><th>Effective Start</th><th>Effective End</th><th class="has-text-centered">Status</th></tr></thead></table>';const l=document.createElement("tbody");for(const t of s){const s=document.createElement("tr");let n=cityssm.escapeHTML(t.licenseeName);""!==t.licenseeBusinessName.trim()&&(n=cityssm.escapeHTML(t.licenseeBusinessName)+'<br /><span class="is-size-7">'+n+"</span>"),s.innerHTML='<td><a href="'+e+"/licences/"+t.licenceId.toString()+'">'+cityssm.escapeHTML(t.licenceNumber)+"</a></td><td>"+cityssm.escapeHTML(t.licenceCategory)+"</td><td>"+n+"</td><td>"+t.startDateString+"</td><td>"+t.endDateString+'</td><td class="has-text-centered">'+(t.issueDate?'<span class="tag is-success">Issued</span>':'<span class="tag is-warning">Pending</span>')+"</td>",l.append(s)}if(a.querySelector("table").append(l),a.insertAdjacentHTML("beforeend",'<div class="level is-block-print"><div class="level-left has-text-weight-bold">Displaying licences '+(r+1).toString()+" to "+Math.min(c+r,t.count).toString()+" of "+t.count.toString()+"</div></div>"),c<t.count){const e=document.createElement("nav");if(e.className="level-right is-hidden-print",e.setAttribute("role","pagination"),e.setAttribute("aria-label","pagination"),r>0){const t=document.createElement("a");t.className="button",t.textContent="Previous",t.addEventListener("click",e=>{e.preventDefault(),n.value=Math.max(0,r-c).toString(),i()}),e.append(t)}if(c+r<t.count){const t=document.createElement("a");t.className="button ml-3",t.innerHTML='<span>Next Licences</span><span class="icon"><i class="fas fa-chevron-right" aria-hidden="true"></i></span>',t.addEventListener("click",e=>{e.preventDefault(),n.value=(r+c).toString(),i()}),e.append(t)}a.querySelector(".level").append(e)}})},c=()=>{n.value="0",i()};t.addEventListener("submit",e=>{e.preventDefault()});const r=t.querySelectorAll(".input, .select select");for(const e of r)e.addEventListener("change",c);c()})();