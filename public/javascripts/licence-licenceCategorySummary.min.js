"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.querySelector("main").dataset.urlPrefix,t=document.querySelector("#filter--startDateStringMin"),c=document.querySelector("#filter--startDateStringMax");t.addEventListener("change",()=>{c.value<t.value&&(c.value=t.value),c.min=t.value});const s=document.querySelector("#form--filters"),n=document.querySelector("#container--licenceCategorySummary"),a=()=>{n.innerHTML='<p class="has-text-centered has-text-grey-lighter"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading licences...</em><br />Please be patient with larger start date ranges.</p>',cityssm.postJSON(e+"/licences/doGetLicenceCategorySummary",s,t=>{try{if(0===t.licences.length)return void(n.innerHTML='<div class="message is-info"><p class="message-body">There are no licences that meet the report criteria.</p></div>');const c=new Map,s=new Map;for(const n of t.licences){const t=n.licenceTransactions.reduce((e,t)=>e+t.transactionAmount,0),a=document.createElement("tr");a.innerHTML='<td><a href="'+e+"/licences/"+n.licenceId+'">'+cityssm.escapeHTML(n.licenceNumber)+"</a></td><td>"+cityssm.escapeHTML(n.licenseeName)+"<br />"+(""===n.licenseeBusinessName?"":cityssm.escapeHTML(n.licenseeBusinessName)+"<br />")+cityssm.escapeHTML(n.licenseeAddress1)+"<br />"+(""===n.licenseeAddress2?"":cityssm.escapeHTML(n.licenseeAddress2)+"<br />")+cityssm.escapeHTML(n.licenseeCity)+", "+cityssm.escapeHTML(n.licenseeProvince)+"<br />"+cityssm.escapeHTML(n.licenseePostalCode)+'</td><td class="has-text-right">$'+t.toFixed(2)+"</td>",c.has(n.licenceCategoryKey)||(c.set(n.licenceCategoryKey,document.createElement("tbody")),c.get(n.licenceCategoryKey).innerHTML='<tr class="is-selected"><th colspan="3">'+cityssm.escapeHTML(n.licenceCategory)+"</th></tr>"),c.get(n.licenceCategoryKey).append(a),s.has(n.licenceCategoryKey)||s.set(n.licenceCategoryKey,{licenceCategoryKey:n.licenceCategoryKey,licenceCategory:n.licenceCategory,licenceCount:0,transactionAmountSum:0});const r=s.get(n.licenceCategoryKey);r.licenceCount+=1,r.transactionAmountSum+=t}const a=[...s.values()];a.sort((e,t)=>e.licenceCategory>t.licenceCategory?1:0);const r=document.createElement("table");r.className="table is-striped is-hoverable is-fullwidth has-sticky-header",r.innerHTML='<thead><tr><th>Licence Number</th><th>Licensee</th><th class="has-text-right">Transaction</th></tr></thead>';let i=0;const o=document.createElement("table");o.className="table is-striped is-hoverable is-fullwidth has-sticky-header",o.innerHTML='<thead><tr><th>Licence Category</th><th class="has-text-right">Count</th><th class="has-text-right">Transactions</th></tr></thead><tbody></tbody><tfoot><th>Total</th></tfoot>';for(const e of a){r.append(c.get(e.licenceCategoryKey));const t=document.createElement("tr");t.innerHTML="<td>"+cityssm.escapeHTML(e.licenceCategory)+'</td><td class="has-text-right">'+e.licenceCount+'</td><td class="has-text-right">$'+e.transactionAmountSum.toFixed(2)+"</td>",o.querySelector("tbody").append(t),i+=e.transactionAmountSum}o.querySelector("tfoot tr").insertAdjacentHTML("beforeend",'<td class="has-text-right">'+t.licences.length+'</td><td class="has-text-right">$'+i.toFixed(2)+"</td>"),n.innerHTML="",n.append(o),n.append(r)}catch(e){console.log(e)}})};s.addEventListener("submit",e=>{e.preventDefault()}),a();const r=s.querySelectorAll("input, select");for(const e of r)e.addEventListener("change",a)})();