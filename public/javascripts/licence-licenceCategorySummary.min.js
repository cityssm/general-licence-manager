"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.querySelector("main").dataset.urlPrefix,t=exports.licenceAlias,c=exports.licenseeAlias,s=document.querySelector("#filter--startDateStringMin"),n=document.querySelector("#filter--startDateStringMax");s.addEventListener("change",()=>{n.value<s.value&&(n.value=s.value),n.min=s.value});const a=document.querySelector("#form--filters"),r=document.querySelector("#container--licenceCategorySummary"),i=()=>{r.innerHTML='<p class="has-text-centered has-text-grey-lighter"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading records...</em><br />Please be patient with larger start date ranges.</p>',cityssm.postJSON(e+"/licences/doGetLicenceCategorySummary",a,s=>{try{if(0===s.licences.length)return void(r.innerHTML='<div class="message is-info"><p class="message-body">There are no records that meet the report criteria.</p></div>');const n=new Map,a=new Map;for(const t of s.licences){const c=t.licenceTransactions.reduce((e,t)=>e+t.transactionAmount,0),s=document.createElement("tr");s.innerHTML='<td><a href="'+e+"/licences/"+t.licenceId+'">'+cityssm.escapeHTML(t.licenceNumber)+"</a></td><td>"+cityssm.escapeHTML(t.licenseeName)+"<br />"+(""===t.licenseeBusinessName?"":cityssm.escapeHTML(t.licenseeBusinessName)+"<br />")+cityssm.escapeHTML(t.licenseeAddress1)+"<br />"+(""===t.licenseeAddress2?"":cityssm.escapeHTML(t.licenseeAddress2)+"<br />")+cityssm.escapeHTML(t.licenseeCity)+", "+cityssm.escapeHTML(t.licenseeProvince)+"<br />"+cityssm.escapeHTML(t.licenseePostalCode)+'</td><td class="has-text-right">$'+c.toFixed(2)+"</td>",n.has(t.licenceCategoryKey)||(n.set(t.licenceCategoryKey,document.createElement("tbody")),n.get(t.licenceCategoryKey).innerHTML='<tr class="is-selected"><th colspan="3">'+cityssm.escapeHTML(t.licenceCategory)+"</th></tr>"),n.get(t.licenceCategoryKey).append(s),a.has(t.licenceCategoryKey)||a.set(t.licenceCategoryKey,{licenceCategoryKey:t.licenceCategoryKey,licenceCategory:t.licenceCategory,licenceCount:0,transactionAmountSum:0});const r=a.get(t.licenceCategoryKey);r.licenceCount+=1,r.transactionAmountSum+=c}const i=[...a.values()];i.sort((e,t)=>e.licenceCategory>t.licenceCategory?1:0);const o=document.createElement("table");o.className="table is-striped is-hoverable is-fullwidth has-sticky-header",o.innerHTML="<thead><tr><th>"+t+" Number</th><th>"+c+'</th><th class="has-text-right">Transaction</th></tr></thead>';let l=0;const d=document.createElement("table");d.className="table is-striped is-hoverable is-fullwidth has-sticky-header",d.innerHTML="<thead><tr><th>"+t+' Category</th><th class="has-text-right">Count</th><th class="has-text-right">Transactions</th></tr></thead><tbody></tbody><tfoot><th>Total</th></tfoot>';for(const e of i){o.append(n.get(e.licenceCategoryKey));const t=document.createElement("tr");t.innerHTML="<td>"+cityssm.escapeHTML(e.licenceCategory)+'</td><td class="has-text-right">'+e.licenceCount+'</td><td class="has-text-right">$'+e.transactionAmountSum.toFixed(2)+"</td>",d.querySelector("tbody").append(t),l+=e.transactionAmountSum}d.querySelector("tfoot tr").insertAdjacentHTML("beforeend",'<td class="has-text-right">'+s.licences.length+'</td><td class="has-text-right">$'+l.toFixed(2)+"</td>"),r.innerHTML="",r.append(d),r.append(o)}catch(e){console.log(e)}})};a.addEventListener("submit",e=>{e.preventDefault()}),i();const o=((e,t,c)=>{let s;return function(...n){const a=this,r=n,i=c&&!s;clearTimeout(s),s=setTimeout(()=>{s=void 0,c||e.apply(a,r)},t),i&&e.apply(a,r)}})(i,200);s.addEventListener("change",o),n.addEventListener("change",o),document.querySelector("#filter--licenceCategoryKey").addEventListener("change",i)})();