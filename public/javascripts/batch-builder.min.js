"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const t=document.querySelector("main").dataset.urlPrefix,e=document.querySelector("#table--transactionBatches");exports.licences;let a=[];const n=e=>{e.preventDefault();const a=e.currentTarget,n=a.value,c=a.closest("td").dataset.batchDateString,o=a.closest("tr").dataset.licenceId;cityssm.postJSON(t+"/batches/updateBatchTransaction",{licenceId:o,batchDateString:c,transactionAmount:n},t=>{t.success?(s=t.batchTransactions,r()):bulmaJS.alert({title:"Update Transaction Error",message:"Please try again.",contextualColorName:"danger"})})},c=()=>{const t=e.querySelectorAll("[data-batch-date-string]");for(const e of t)e.remove();const c=e.querySelectorAll("tbody tr");for(const t of a){const a=document.createElement("th");a.dataset.batchDateString=t,a.innerHTML=t,e.querySelector("thead th:last-child").insertAdjacentElement("beforebegin",a);for(const e of c){const a=document.createElement("td");a.dataset.batchDateString=t,a.innerHTML='<div class="control has-icons-left"><input class="input is-small has-text-right" data-field="transactionAmount" type="number" min="0" /><span class="icon is-small is-left"><i class="fas fa-dollar-sign" aria-hidden="true"></i></span></div>';const c=a.querySelector("input");c.max=e.dataset.max,c.addEventListener("change",n),e.querySelector("td:last-child").insertAdjacentElement("beforebegin",a)}}};let s=exports.batchTransactions;(()=>{const t=new Set;for(const e of s)t.add(e.batchDateString);(a=[...t.values()]).sort()})();const r=()=>{for(const t of s){e.querySelector("tr[data-licence-id='"+t.licenceId+"']").querySelector("td[data-batch-date-string='"+t.batchDateString+"']").querySelector("input").value=t.transactionAmount.toFixed(2)}};c(),r(),document.querySelector("#is-add-batch-button").addEventListener("click",t=>{let e,n;t.preventDefault();const s=t=>{t.preventDefault();const s=e.value;a.includes(s)?bulmaJS.alert({title:"Batch Date Already Included",message:"To add a new batch, choose a new date."}):(a.push(s),a.sort(),n(),c(),r())};cityssm.openHtmlModal("batchBuilder-addBatch",{onshown:(t,a)=>{e=t.querySelector("#addBatch--batchDateString"),n=a,t.querySelector("#form--addBatch").addEventListener("submit",s)}})})})();