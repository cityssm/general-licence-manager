"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.querySelector("main").dataset.urlPrefix,t=""===document.querySelector("#licenceEdit--licenceId").value;document.querySelector("#form--licenceEdit").addEventListener("submit",c=>{c.preventDefault();const n=e+"/licences/"+(t?"doCreateLicence":"doUpdateLicence");cityssm.postJSON(n,c.currentTarget,c=>{c.success?t?window.location.href=e+"/licences/"+c.licenceId.toString()+"/edit":bulmaJS.alert({message:"Licence Updated Successfully",contextualColorName:"success"}):bulmaJS.alert({title:"Error Updating Licence",message:c.errorMessage,contextualColorName:"danger"})})});const c=document.querySelector("#licenceEdit--licenceCategoryKey"),n=document.querySelector("#licenceEdit--isRenewal"),i=document.querySelector("#licenceEdit--startDateString"),l=document.querySelector("#licenceEdit--endDateString"),a=()=>{const e=i.valueAsDate;if(!e||""===c.value)return void(l.value="");const t=c.selectedOptions[0],n=Number.parseInt(t.dataset.licenceLengthYears),a=Number.parseInt(t.dataset.licenceLengthMonths),r=Number.parseInt(t.dataset.licenceLengthDays);n>0&&(e.setFullYear(e.getFullYear()+n),e.setDate(e.getDate()-1)),a>0&&(e.setMonth(e.getMonth()+a),e.setDate(e.getDate()-1)),r>0&&e.setDate(e.getDate()+r-1),l.valueAsDate=e};let r;t&&c.addEventListener("change",a),i.addEventListener("change",a);const o=()=>{const e=document.querySelector("#licenceEdit--licenceFee"),t=document.querySelector("#licenceEdit--replacementFee");if(!r||0===r.licenceCategoryFees.length)return e.value="",void(t.value="");e.value=n.checked?r.licenceCategoryFees[0].renewalFee.toFixed(2):r.licenceCategoryFees[0].licenceFee.toFixed(2),t.value=r.licenceCategoryFees[0].replacementFee.toFixed(2)},s=()=>{(()=>{const e=document.querySelector("#container--licenceFields");if(!r||0===r.licenceCategoryFields.length)return e.innerHTML="",void e.classList.add("is-hidden");e.classList.remove("is-hidden"),e.innerHTML='<h2 class="panel-heading">Fields</h2>';const t=[];for(const c of r.licenceCategoryFields){const n=document.createElement("div");n.className="panel-block is-block",n.innerHTML='<div class="field"><label class="label"></label><div class="control"><input class="input" type="text" /></div></div>';const i="licenceFieldEdit--"+c.licenceFieldKey,l=n.querySelector("label");l.setAttribute("for",i),l.textContent=c.licenceField;const a=n.querySelector("input");if(a.id=i,a.name="field--"+c.licenceFieldKey,a.minLength=c.minimumLength,a.maxLength=c.maximumLength,""!==c.pattern&&(a.pattern=c.pattern),c.isRequired&&(a.required=!0),""!==c.licenceFieldDescription){const e=document.createElement("p");e.className="help",e.textContent=c.licenceFieldDescription,n.append(e)}e.append(n),t.push(c.licenceFieldKey)}const c=document.createElement("input");c.type="hidden",c.name="licenceFieldKeys",c.value=t.join(","),e.append(c)})(),(()=>{const e=document.querySelector("#container--licenceApprovals");if(!r||0===r.licenceCategoryApprovals.length)return e.innerHTML="",void e.classList.add("is-hidden");e.classList.remove("is-hidden"),e.innerHTML='<h2 class="panel-heading">Approvals</h2>';const t=[];for(const c of r.licenceCategoryApprovals){const i=document.createElement("div");i.className="panel-block is-block",i.innerHTML='<div class="facheck"><input type="checkbox" /><label></label></div>';const l="licenceApprovalEdit--"+c.licenceApprovalKey,a=i.querySelector("label");a.setAttribute("for",l),a.textContent=c.licenceApproval;const r=i.querySelector("input");if(r.id=l,r.name="approval--"+c.licenceApprovalKey,r.dataset.isRequiredForNew=c.isRequiredForNew?"true":"false",r.dataset.isRequiredForRenewal=c.isRequiredForRenewal?"true":"false",(n.checked&&c.isRequiredForRenewal||!n.checked&&c.isRequiredForNew)&&(r.required=!0),""!==c.licenceApprovalDescription){const e=document.createElement("p");e.className="help",e.textContent=c.licenceApprovalDescription,i.append(e)}e.append(i),t.push(c.licenceApprovalKey)}const c=document.createElement("input");c.type="hidden",c.name="licenceApprovalKeys",c.value=t.join(","),e.append(c)})(),o()},d=()=>{if(""===c.value)return r=void 0,void s();cityssm.postJSON(e+"/licences/doGetLicenceCategory",{licenceCategoryKey:c.value},e=>{r=e.licenceCategory,s()})};t?(c.addEventListener("change",d),""!==c.value&&d()):r=exports.licenceCategory,n.addEventListener("change",()=>{const e=document.querySelector("#container--licenceApprovals").querySelectorAll("input");for(const t of e)t.required=!!(n.checked&&"true"===t.dataset.isRequiredForRenewal||!n.checked&&"true"===t.dataset.isRequiredForNew);o()});const u=e=>{e.preventDefault(),cityssm.openHtmlModal("transaction-add",{onshow:e=>{}})};t||document.querySelector("#button--addTransaction").addEventListener("click",u)})();