"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.querySelector("main").dataset.urlPrefix,t=exports.licenceAlias,a=exports.licenceAliasPlural,s=exports.licenseeAlias,i=document.querySelector("#form--filters"),n=document.querySelector("#filter--limit"),r=document.querySelector("#filter--offset"),c=document.querySelector("#container--searchResults"),l=()=>{const o=Number.parseInt(n.value,10),d=Number.parseInt(r.value,10);c.innerHTML='<p class="has-text-centered has-text-grey"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading records...</em></p>',cityssm.postJSON(e+"/licences/doSearch",i,i=>{const n=i.licences;if(0===n.length)return void(c.innerHTML='<div class="message is-info"><div class="message-body"><strong>Your search returned no results.</strong><br />Please try expanding your search criteria.</div></div>');c.innerHTML='<table class="table is-fullwidth is-striped is-hoverable has-sticky-header"><thead><tr><th>'+t+" Number</th><th>Category</th><th>"+s+'</th><th>Effective</th><th>Fields</th><th aria-label="Issued Status"></th></tr></thead></table>';const u=document.createElement("tbody");for(const a of n){const s=document.createElement("tr");s.dataset.cy=a.issueDate?"issued":"pending";let i=cityssm.escapeHTML(a.licenseeName);""!==a.licenseeBusinessName.trim()&&(i=cityssm.escapeHTML(a.licenseeBusinessName)+'<br /><span class="is-size-7">'+i+"</span>");let n="";for(const e of a.licenceFields)e.licenceFieldValue&&""!==e.licenceFieldValue&&(n+=cityssm.escapeHTML(e.licenceField)+": "+cityssm.escapeHTML(e.licenceFieldValue)+"<br />");s.innerHTML='<td><a href="'+e+"/licences/"+a.licenceId.toString()+'">'+cityssm.escapeHTML(a.licenceNumber)+"</a><br /></td><td>"+cityssm.escapeHTML(a.licenceCategory)+"</td><td>"+i+'</td><td><span class="is-nowrap has-tooltip-right" data-tooltip="Start Date" aria-label="Start Date"><i class="fas fa-fw fa-play" aria-hidden="true"></i> '+a.startDateString+'</span><br /><span class="is-nowrap has-tooltip-right" data-tooltip="End Date" aria-label="End Date"><i class="fas fa-fw fa-stop" aria-hidden="true"></i> '+a.endDateString+'</span></td><td><span class="is-size-7">'+n+'</span></td><td class="has-text-centered">'+(a.issueDate?'<a class="button is-small" href="'+e+"/licences/"+a.licenceId+'/print" data-tooltip="Print '+t+'" target="_blank" aria-label="Print"><i class="fas fa-print" aria-hidden="true"></i></a>':'<span class="tag is-warning">Pending</span>')+"</td>",u.append(s)}if(c.querySelector("table").append(u),c.insertAdjacentHTML("beforeend",'<div class="level is-block-print"><div class="level-left has-text-weight-bold">Displaying '+a+" "+(d+1).toString()+" to "+Math.min(o+d,i.count).toString()+" of "+i.count.toString()+"</div></div>"),o<i.count){const e=document.createElement("nav");if(e.className="level-right is-hidden-print",e.setAttribute("role","navigation"),e.setAttribute("aria-label","pagination"),d>0){const t=document.createElement("button");t.className="button",t.textContent="Previous",t.type="button",t.addEventListener("click",e=>{e.preventDefault(),r.value=Math.max(0,d-o).toString(),l()}),e.append(t)}if(o+d<i.count){const t=document.createElement("button");t.className="button ml-3",t.type="button",t.innerHTML="<span>Next "+a+'</span><span class="icon"><i class="fas fa-chevron-right" aria-hidden="true"></i></span>',t.addEventListener("click",e=>{e.preventDefault(),r.value=(d+o).toString(),l()}),e.append(t)}c.querySelector(".level").append(e)}})},o=()=>{r.value="0",l()};i.addEventListener("submit",e=>{e.preventDefault()});const d=i.querySelectorAll(".input, .select select");for(const e of d)e.addEventListener("change",o);o()})();