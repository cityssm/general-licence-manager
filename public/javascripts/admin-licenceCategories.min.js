"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.querySelector("main").dataset.urlPrefix;let t=exports.licenceCategories;const c=document.querySelector("#container--licenceCategories"),i=()=>{if(0===t.length)return void(c.innerHTML='<div class="message is-warning"><p class="message-body">There are no licence categories available.</p></div>');const e=document.createElement("div");e.className="panel";for(const c of t){const t=document.createElement("a");t.className="panel-block is-block",t.dataset.licenceCategoryKey=c.licenceCategoryKey,t.innerHTML="<strong>"+cityssm.escapeHTML(c.licenceCategory)+'</strong><br /><div class="columns"><div class="column has-text-centered">'+(c.hasEffectiveFee?'<i class="fas fa-check has-text-success"></i><br /><span class="is-size-7">Effective Fee</span>':'<i class="fas fa-exclamation-triangle has-text-danger"></i><br /><span class="is-size-7">No Effective Fee</span>')+'</div><div class="column has-text-centered">'+(""===c.printEJS?'<i class="fas fa-exclamation-triangle has-text-danger"></i><br /><span class="is-size-7">No Print Template</span>':'<i class="fas fa-check has-text-success"></i><br /><span class="is-size-7">Print Template</span>')+"</div></div>",t.addEventListener("click",g),e.append(t)}c.innerHTML="",c.append(e)};let n,a,r=!1;const l=t=>{let c;const i=t=>{t.preventDefault(),cityssm.postJSON(e+"/admin/doUpdateLicenceCategoryField",t.currentTarget,e=>{e.success&&(a=e.licenceCategoryFields,c(),o())})},n=a.find(e=>e.licenceFieldKey===t);cityssm.openHtmlModal("licenceCategoryField-edit",{onshow:e=>{e.querySelector("#licenceCategoryFieldEdit--licenceFieldKey").value=t,e.querySelector("#licenceCategoryFieldEdit--licenceField").value=n.licenceField,e.querySelector("#licenceCategoryFieldEdit--licenceFieldDescription").value=n.licenceFieldDescription,n.isRequired&&(e.querySelector("#licenceCategoryFieldEdit--isRequired").checked=!0);const c=e.querySelector("#licenceCategoryFieldEdit--minimumLength"),i=e.querySelector("#licenceCategoryFieldEdit--maximumLength");c.value=n.minimumLength.toString(),c.addEventListener("keyup",()=>{i.min=c.value}),i.value=n.maximumLength.toString(),i.min=n.minimumLength.toString(),e.querySelector("#licenceCategoryFieldEdit--pattern").value=n.pattern},onshown:(e,t)=>{c=t,e.querySelector("#form--licenceCategoryFieldEdit").addEventListener("submit",i)}})},s=e=>{e.preventDefault();const t=e.currentTarget.dataset.licenceFieldKey;l(t)},o=()=>{const e=n.querySelector("#container--licenceCategoryFields");if(0===a.length)e.innerHTML='<div class="message is-info"><p class="message-body">There are no additional fields captured with this licence.</p></div>';else{const t=document.createElement("div");t.className="panel";for(const e of a){const c=document.createElement("a");c.className="panel-block is-block",c.dataset.licenceFieldKey=e.licenceFieldKey,c.innerHTML="<h4>"+cityssm.escapeHTML(e.licenceField)+'</h4><p class="is-size-7">'+cityssm.escapeHTML(e.licenceFieldDescription)+"</p>",c.addEventListener("click",s),t.append(c)}e.innerHTML="",e.append(t)}};let d;let u;const y=s=>{const y=t=>{t.preventDefault();const c=t.currentTarget;cityssm.postJSON(e+"/admin/doUpdateLicenceCategory",c,e=>{e.success?(bulmaJS.alert({message:"Licence Category updated successfully.",contextualColorName:"success"}),r=!0):bulmaJS.alert({title:"Error Updating Licence Category",message:e.errorMessage,contextualColorName:"danger"})})},g=t=>{t.preventDefault();const c=t.currentTarget;cityssm.postJSON(e+"/admin/doAddLicenceCategoryField",c,e=>{e.success&&(r=!0,c.reset(),a=e.licenceCategoryFields,o(),l(e.licenceFieldKey))})},m=t=>{t.preventDefault();const c=t.currentTarget;cityssm.postJSON(e+"/admin/doAddLicenceCategoryApproval",c,e=>{e.success&&(r=!0,c.reset(),d=e.licenceCategoryApprovals,e.licenceApprovalKey)})},p=e=>{if(!e.success)return bulmaJS.alert({message:"Error loading Licence Category.",contextualColorName:"danger"}),void(r=!0);const t=e.licenceCategory;n.querySelector("#licenceCategoryEdit--licenceCategory").value=t.licenceCategory,n.querySelector("#licenceCategoryEdit--bylawNumber").value=t.bylawNumber;const c=n.querySelector("#licenceCategoryEdit--printEJS");if(!c.querySelector("option[value='"+t.printEJS+"']")){const e=document.createElement("option");e.value=t.printEJS,e.textContent=t.printEJS+" (Missing)",c.append(e)}c.value=t.printEJS,n.querySelector("#licenceCategoryEdit--licenceLengthYears").value=t.licenceLengthYears.toString(),n.querySelector("#licenceCategoryEdit--licenceLengthMonths").value=t.licenceLengthMonths.toString(),n.querySelector("#licenceCategoryEdit--licenceLengthDays").value=t.licenceLengthDays.toString(),a=t.licenceCategoryFields,o(),d=t.licenceCategoryApprovals,u=t.licenceCategoryFees};r=!1,cityssm.openHtmlModal("licenceCategory-edit",{onshow:t=>{n=t,t.querySelector("#licenceCategoryEdit--licenceCategoryKey").value=s,t.querySelector("#licenceCategoryFieldAdd--licenceCategoryKey").value=s,t.querySelector("#licenceCategoryApprovalAdd--licenceCategoryKey").value=s;const c=t.querySelector("#licenceCategoryEdit--printEJS");for(const e of exports.printEJSList){const t=document.createElement("option");t.value=e,t.textContent=e,c.append(t)}cityssm.postJSON(e+"/admin/doGetLicenceCategory",{licenceCategoryKey:s},p)},onshown:e=>{e.querySelector("#form--licenceCategoryEdit").addEventListener("submit",y),e.querySelector("#form--licenceCategoryFieldAdd").addEventListener("submit",g),e.querySelector("#form--licenceCategoryApprovalAdd").addEventListener("submit",m),bulmaJS.toggleHtmlClipped()},onhidden:()=>{r&&(c.innerHTML='<p class="has-text-centered has-text-grey-lighter"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading licence categories...</em></p>',cityssm.postJSON(e+"/admin/doGetLicenceCategories",{},e=>{t=e.licenceCategories,i()}))},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})},g=e=>{e.preventDefault();const t=e.currentTarget.dataset.licenceCategoryKey;y(t)};i(),document.querySelector("#button--addLicenceCategory").addEventListener("click",()=>{let c;const n=n=>{n.preventDefault(),cityssm.postJSON(e+"/admin/doAddLicenceCategory",n.currentTarget,e=>{e.success&&(t=e.licenceCategories,i(),c(),y(e.licenceCategoryKey))})};cityssm.openHtmlModal("licenceCategory-add",{onshown:(e,t)=>{bulmaJS.toggleHtmlClipped(),c=t,e.querySelector("form").addEventListener("submit",n)},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})})})();